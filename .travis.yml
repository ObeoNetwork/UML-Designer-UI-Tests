language: java
jdk: oraclejdk7
env:
  global:
  - DISPLAY=:99.0
  - RUNNER=../obeo-umldesigner-nightly.s3.amazonaws.com/releng/rcptt.runner-2.0.1.zip
  - if [[ "$TRAVIS_TAG" == "" ]]; then AUT=../obeo-umldesigner-nightly.s3.amazonaws.com/${TRAVIS_BRANCH}/bundles/UMLDesigner-linux.gtk.x86_64.zip;
    else AUT=../obeo-umldesigner-releases.s3.amazonaws.com/${TRAVIS_BRANCH}/bundles/UMLDesigner-linux.gtk.x86_64.zip;fi
  - TESTS_RESULTS_DIR=${TRAVIS_BUILD_DIR}/nightly/${TRAVIS_BRANCH}/tests-results
  matrix:
  - TEST_SUITE=ActivityDiagram
  - TEST_SUITE=ClassDiagram
  - TEST_SUITE=ComponentDiagram
  - TEST_SUITE=CompositeStructureDiagram
  - TEST_SUITE=Dashboard
  - TEST_SUITE=DeploymentDiagram
  - TEST_SUITE=DocumentationTable
  - TEST_SUITE=Examples
  - TEST_SUITE=NewProject
  - TEST_SUITE=PackageContainmentDiagram
  - TEST_SUITE=PackageHierarchy
  - TEST_SUITE=ProfileDiagram
  - TEST_SUITE=ReusedTools
  - TEST_SUITE=SequenceDiagram
  - TEST_SUITE=StateMachineDiagram
  - TEST_SUITE=UseCaseDiagram
install: true
sudo: false
cache:
  directories:
  - $HOME/.m2
addons:
  apt:
    packages:
    - metacity
before_script:
 - export SWT_GTK3=0
 - /sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1440x900x16
 - sh -e /etc/init.d/xvfb start
 - sleep 10
 - metacity --sm-disable --replace &
 - sleep 10
 - wget -mN http://obeo-umldesigner-nightly.s3.amazonaws.com/releng/rcptt.runner-2.0.1.zip
 - echo $TRAVIS_TAG
 - if [[ "$TRAVIS_TAG" == "" ]]; then wget -mN http://obeo-umldesigner-nightly.s3.amazonaws.com/${TRAVIS_BRANCH}/bundles/UMLDesigner-linux.gtk.x86_64.zip;
  else wget -mN http://obeo-umldesigner-releases.s3.amazonaws.com/${TRAVIS_BRANCH}/bundles/UMLDesigner-linux.gtk.x86_64.zip;fi
script:
 - export
 - mvn clean test -f org.obeonetwork.dsl.uml2.tests.rcptt/pom.xml -Daut=$AUT -Drcpttrunner=$RUNNER -Dsuite=$TEST_SUITE
deploy:
 - provider: s3
   access_key_id: AKIAJJVZATSVUD3VGHXA
   secret_access_key:
     secure: AmWdqd6v5iZymgS7SIwMmSWdcRqTPazWH01A5F2dmYmeRYgB+w+InC7QGVBO86nSvwiXn6lH7XbBIYGDSpetM2dQT4/0ErBuhkkNKylQc+f595lKIz7K2XCfhu/Q5tlj5UQsG86y+Kaz7EPk73q8zTfjubjCLu0bdeQYOa8TQoayRKGPl7rOKqb0EVZfqX0LnS3Dr9QVEnTgHkHKau0qSpoKVNUsy2Yoc+uviogb3Efo3Xq2j6Sp+49mmcA1OJFvw30dqJSdJU40B0Kl8wasHRFBK7o8a1PxFxUylmHZOwfzFchikz1bJ97up7/Q5Q12/lid7sgLx4KF7xxgGnhj8VaZ4HbQVy1lupT5iDcekIIuZFfZQgRR/P5Jl1pJVR9IIi4PAznNp8662x9YTNuDxdse8QfA9wmIZmMKtMLXQfhLCt4MN9WggolnFbvLof4cpcIVffWP8mmQfjB+vYBpUhAM957ek7d+45fGwqbZ9tGygeuwSZgJ1UF4oDH7ViilM7EZ9BG2In7NjAM4zjBtOOMOSpUNHBma7Hiep4HRV7pYWm/xmji/SihRkkTBVhkpuL6P5PuERuRG3HS1TBT51XwnwluGG0lmwPrE9wZRahKnUxwNwfds6T6Mpq2gXyHK6D2efZqpdfR6gybb0v+xyr/QrIqnMFoWr9OSzt64m4w=
   bucket: obeo-umldesigner-nightly
   local-dir: "${TRAVIS_BUILD_DIR}/org.obeonetwork.dsl.uml2.tests.rcptt/target/results"
   acl: public_read
   skip_cleanup: true
   region: eu-west-1
   upload-dir: "${TRAVIS_BRANCH}/test-results/${TRAVIS_JOB_NUMBER}"
   on:
     repo: ObeoNetwork/UML-Designer-UI-Tests
     branch: master
 - provider: s3
   access_key_id: AKIAJJVZATSVUD3VGHXA
   secret_access_key:
    secure: AmWdqd6v5iZymgS7SIwMmSWdcRqTPazWH01A5F2dmYmeRYgB+w+InC7QGVBO86nSvwiXn6lH7XbBIYGDSpetM2dQT4/0ErBuhkkNKylQc+f595lKIz7K2XCfhu/Q5tlj5UQsG86y+Kaz7EPk73q8zTfjubjCLu0bdeQYOa8TQoayRKGPl7rOKqb0EVZfqX0LnS3Dr9QVEnTgHkHKau0qSpoKVNUsy2Yoc+uviogb3Efo3Xq2j6Sp+49mmcA1OJFvw30dqJSdJU40B0Kl8wasHRFBK7o8a1PxFxUylmHZOwfzFchikz1bJ97up7/Q5Q12/lid7sgLx4KF7xxgGnhj8VaZ4HbQVy1lupT5iDcekIIuZFfZQgRR/P5Jl1pJVR9IIi4PAznNp8662x9YTNuDxdse8QfA9wmIZmMKtMLXQfhLCt4MN9WggolnFbvLof4cpcIVffWP8mmQfjB+vYBpUhAM957ek7d+45fGwqbZ9tGygeuwSZgJ1UF4oDH7ViilM7EZ9BG2In7NjAM4zjBtOOMOSpUNHBma7Hiep4HRV7pYWm/xmji/SihRkkTBVhkpuL6P5PuERuRG3HS1TBT51XwnwluGG0lmwPrE9wZRahKnUxwNwfds6T6Mpq2gXyHK6D2efZqpdfR6gybb0v+xyr/QrIqnMFoWr9OSzt64m4w=
   bucket: obeo-umldesigner-releases
   local-dir: "${TRAVIS_BUILD_DIR}/org.obeonetwork.dsl.uml2.tests.rcptt/target/results"
   acl: public_read
   skip_cleanup: true
   region: eu-west-1
   upload-dir: "${TRAVIS_TAG}/test-results/${TRAVIS_JOB_NUMBER}"
   on:
     tags: true
     all_branches: true
     repo: ObeoNetwork/UML-Designer-UI-Tests